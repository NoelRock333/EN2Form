{% extends '../layout.html' %}

{% block styles %}
	<link rel="stylesheet" href="/stylesheets/jquery.dataTables.css">
{% endblock %}

{% block content %}
<table class="table table-striped table-bordered" id="tabla-expedientes">
	<thead>
		<tr>
			<th>ID</th>
			<th>Fecha</th>
			<th>Paciente</th>
			<th>Dientes</th>
			<th>Notas</th>
			<th>Acciones</th>
		</tr>
	</thead>
	<tbody>
		{% for expediente in expedientes %}
			<tr>
				<td><%= expediente.id %></td>
				<td><%= expediente.fecha_expediente %></td>
				<td><%= expediente.nombre_completo %></td>
				<td><%= expediente.piezas_dentales %></td>
				<td><%= expediente.nota_evolucion %></td>
				<td>
					<a href="/expediente/<%= expediente.id %>/edit">Editar</a>
					<a href="#" data-id="<%= expediente.id %>" class="js_eliminar">Eliminar</a>
				</td>
			</tr>
		{% endfor %}
	</tbody>
</table>
{% endblock %}

{% block scripts %}
	<script type="text/javascript" src="/javascripts/jquery.dataTables.js"></script>
	<script type="text/javascript">
		$(document).on("ready", function(){
			$('#tabla-expedientes').DataTable();
			$(".table").on("click", ".js_eliminar", function(e){
				e.preventDefault();
				var id_expediente = $(this).data('id');
				bootbox.dialog({
					title: "Â¿Estas seguro de que quieres eliminar este registro expediente?",
					message: "Expediente numero: <b>"+id_expediente+"</b>",
					buttons: {
						danger: {
							label: "Eliminar",
							className: "btn-danger",
							callback: function() {
								$.ajax({
									url: "/expediente",
									data: { id: id_expediente },
									type: "DELETE",
									success: function(data) {
										if(data.length > 0){
											location.reload();
										}
										else{
											bootbox.alert("Ha ocurrido un error al intentar eliminar");
										}
									}
								});
							}
						},
						success: {
							label: "Cancelar",
							className: "btn-default",
							callback: function() {
							}
						}
					}
				});
			})
		});
	</script>
{% endblock %}
